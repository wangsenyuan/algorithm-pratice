package main

import "testing"

func runSample(t *testing.T, s string, expect bool) {
	ok, res := solve(s)

	if ok != expect {
		t.Fatalf("Sample expect %t, but got %t, %s", expect, ok, res)
	}
	if !expect {
		return
	}
	var sum int
	sign := 1
	var num int
	for i := 0; i < len(res); i++ {
		if isDigit(res[i]) {
			num = num*10 + int(res[i]-'0')
		} else {
			sum += sign * num
			num = 0
			if res[i] == '+' {
				sign = 1
			} else if res[i] == '-' {
				sign = -1
			}
		}
	}

	n := getLastN(s)

	if sum != n {
		t.Fatalf("Sample result %s, not correct", res)
	}
}

func isDigit(x byte) bool {
	return x >= '0' && x <= '9'
}

func TestSample1(t *testing.T) {
	s := "? + ? - ? + ? + ? = 42"
	expect := true
	runSample(t, s, expect)
}

func TestSample2(t *testing.T) {
	s := "? - ? = 1"
	expect := false
	runSample(t, s, expect)
}

func TestSample3(t *testing.T) {
	s := "? = 1000000"
	expect := true
	runSample(t, s, expect)
}

func TestSample4(t *testing.T) {
	s := "? - ? + ? + ? + ? + ? - ? - ? - ? - ? + ? - ? - ? - ? + ? - ? + ? + ? + ? - ? + ? + ? + ? - ? + ? + ? - ? + ? - ? + ? - ? - ? + ? + ? + ? + ? + ? + ? + ? - ? + ? + ? + ? + ? - ? - ? - ? + ? - ? - ? - ? - ? - ? - ? + ? - ? + ? + ? - ? - ? - ? - ? + ? - ? - ? + ? + ? - ? + ? + ? - ? - ? - ? + ? + ? - ? - ? + ? - ? - ? + ? - ? + ? - ? - ? - ? - ? + ? - ? + ? - ? + ? + ? + ? - ? + ? + ? - ? - ? + ? = 123456"
	expect := true
	runSample(t, s, expect)
}

func TestSample5(t *testing.T) {
	s := "? + ? + ? + ? + ? + ? + ? + ? - ? - ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? - ? + ? + ? - ? - ? + ? + ? - ? - ? + ? + ? + ? - ? - ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? - ? + ? + ? + ? - ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? - ? + ? + ? + ? + ? + ? + ? - ? + ? + ? + ? + ? + ? + ? + ? + ? + ? + ? - ? - ? + ? + ? + ? - ? + ? + ? - ? - ? + ? - ? + ? + ? + ? = 4"
	expect := true
	runSample(t, s, expect)
}
